---
marp: true
theme: default
style: |
    section {
        font-family: Arial, sans-serif; font-size:20px;
    }
    h1 {
        color: #0055A4;
    }
    h2 {
        color: #0072CE;
    }
    strong {
        color: #E63946;
    }
header: Временные ряды
footer: БГУ ФПМИ ФМИиС
paginate: true
---

<!-- _class: title -->
# **Временные ряды: от классических моделей до практических тонкостей**
## Стационарность, ARIMA, Prophet, Деревья, Кластеризация и проблемы валидации
<br>
<br>
**ФИО докладчика**
**Организация**
**Дата**

![bg right:40% w:400](https://miro.medium.com/v2/resize:fit:1400/1*J5qNdJkYGa9kAY8j4jfUOg.png)

---



1. **Введение:** Что такое временные ряды? Ключевые компоненты.
2. **Основные концепции:** Стационарность, автокорреляция.
3. **Золотые правила валидации моделей** (самая важная практическая часть).
4. **Классические модели:** ARIMA.
5. **Современные подходы:** Prophet, Neural Prophet.
6. **Ансамбли и деревья:** Решающие деревья для временных рядов.
7. **Кластеризация временных рядов.**
8. **Проблема "холодного старта".**
9. **Заключение и выводы.**

---

### **Часть 1: Основные концепции**

## Что такое временной ряд?

*   **Определение:** Упорядоченная последовательность точек данных, собранных в последовательные моменты времени.
*   **Примеры:**
    *   Ежедневная цена акции.
    *   Еженедельные продажи магазина.
    *   Помесячная температура воздуха.
*   **Цель анализа:** Понимание структуры, прогнозирование будущих значений.

![bg right:30% w:300](https://www.investopedia.com/thmb/7bYaaPcXvxL4NvYF5K2pXKJtNwM=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/Term-Definitions_Time-Series--f993c67c62f14b4e9a5c4b6a8996c69c.jpg)

---

## Ключевые компоненты временного ряда

**Декомпозиция ряда:**
*   **Тренд (Trend):** Долгосрочное направление ряда.
    *Пример: общий рост выручки компании.*
*   **Сезонность (Seasonality):** Периодические колебания.
    *Пример: пики продаж мороженого летом.*
*   **Цикл (Cycle):** Колебания без строгой фиксированной частоты.
*   **Шум/Остаток (Residual):** Случайная, необъяснимая компонента.

![w:900](https://otexts.com/fpp3/fpp_files/figure-html/dec-1.png)

---

## Стационарность — краеугольный камень

*   **Почему важна?** Большинство классических моделей работают со стационарными рядами.
*   **Определение:** Его статистические свойства (среднее, дисперсия) постоянны во времени.
*   **Как добиться стационарности?**
    *   **Дифференцирование (d=1):** `Y_t = original_t - original_{t-1}`. Убирает тренд.
    *   **Логарифмирование:** Стабилизирует дисперсию.

![bg right:40% w:400](https://www.gaussianwaves.com/gaussianwaves/wp-content/uploads/2015/06/NonStationary_Process.png)

---

## Автокорреляция (ACF) и Частичная автокорреляция (PACF)

*   **ACF:** Корреляция ряда с самим собой на разных лагах. Обнаруживает сезонность.
*   **PACF:** Корреляция между рядом и его лагом, при устранении влияния всех промежуточных лагов. Критична для ARIMA.

**Как выглядит:**
![w:1000](https://images.slideplayer.com/26/8820039/slides/slide_5.jpg)

---

### **Часть 2: Валидация моделей (самое важное!)**

## Принцип валидации: "Тестируй так, как будешь использовать"

*   **Ошибка:** Случайное разбиение на train/test НЕДОПУСТИМО.
*   **Правило:** Сохраняй временной порядок. Модель не должна "заглядывать в будущее".
*   **Метод:** **Rolling Window / Walk-Forward Validation.**

![w:700](https://raw.githubusercontent.com/DarrenCook/h2o/gh-pages/h2o/ts/rolling_cv.png)

---

## Тонкости реальных данных (Data Leakage)

*   **Проблема 1: "Обновляемые на ходу" данные.**
    *   *Пример:* Баланс пользователя в БД. Его историческое значение может измениться.
*   **Решение: Фиксация снепшотов (Snapshotting).**
    *   Регулярно сохранять состояние всех признаков и таргета.
*   **Проблема 2: Признаки с задержкой доступности.**
    *   *Пример:* Выручка за день доступна только к обеду следующего дня.
*   **Решение:** Тщательно согласовывать временные метки всех признаков.

---

### **Часть 3: Классические модели**

## Модель ARIMA (AutoRegressive Integrated Moving Average)

*   **"Золотой стандарт"** прогнозирования.
*   **AR(p) - Авторегрессия:** Зависимость от `p` предыдущих значений.
*   **I(d) - Интегрирование:** Количество дифференцирований.
*   **MA(q) - Скользящее среднее:** Зависимость от ошибок прогноза.
*   **Полная запись:** ARIMA(p, d, q)

**Как подобрать параметры?**
*   **d:** Тест Дики-Фуллера.
*   **p:** График **PACF**.
*   **q:** График **ACF**.

---

## Плюсы и минусы ARIMA

*   **Плюсы:**
    *   Мощный и гибкий инструмент.
    *   Хорошо интерпретируема.
    *   Широко известна.
*   **Минусы:**
    *   Требует стационарности.
    *   Плохо работает с сильным шумом.
    *   Сложность ручного подбора.

![bg right:30% w:300](https://www.researchgate.net/publication/354455261/figure/fig1/AS:1061460503506945@1630752859518/ARIMA-Model-Results.png)

---

### **Часть 4: Современные модели от Facebook**

## Prophet

**Философия:** Модель для бизнес-аналитиков. Проста, автоматизирована, robust.
`y(t) = g(t) + s(t) + h(t) + ε_t`
*   `g(t)` — тренд.
*   `s(t)` — сезонность (Фурье).
*   `h(t)` — эффект праздников.
*   **Не требует стационарности.**

![bg right:40% w:400](https://facebook.github.io/prophet/static/quick_start_files/quick_start_12_0.png)

---

## Почему Prophet так популярен? Neural Prophet

| Характеристика       | Prophet              | Neural Prophet         |
|----------------------|----------------------|------------------------|
| **Основа**           | Статистика (STAN)    | Нейросеть (PyTorch)    |
| **Скорость**         | Очень быстрая        | Медленнее (GPU)        |
| **Lagged Features**  | Нет                  | **Да**                 |
| **AR-компонента**    | Нет                  | **Да**                 |

*   **Плюсы Prophet:** Автоматизация, праздники, robust.
*   **Минусы Prophet:** "Черный ящик".
*   **Neural Prophet:** Часто точнее, лучше кастомизируется.

---

### **Часть 5: Деревья и ансамбли**

## Решающие деревья для временных рядов

**Идея:** Превратить прогнозирование **временного ряда** в задачу **регрессии**.

**Какие признаки создавать?**
*   Лаги исходного ряда (`lag_1`, `lag_7`, ...).
*   Скользящие статистики: среднее, std.
*   Признаки времени: час, день недели.
*   Признаки событий: праздники.

**Преимущества:**
*   Работа с внешними признаками (погода, курс).
*   Не требуют стационарности.
*   Мощные ансамбли (LightGBM, XGBoost).

---

### **Часть 6: Кластеризация временных рядов**

## Зачем кластеризовать временные ряды?

**Задача:** Найти группы похожих временных рядов.

**Примеры применения:**
*   **Ритейл:** Кластеризация товаров по динамике продаж.
*   **Техмониторинг:** Поиск аномальных паттернов.
*   **Финансы:** Группировка акций.

![bg right:30% w:400](https://d1m75rqqgidzqn.cloudfront.net/wp-data/2020/04/10155515/shutterstock_563583135.jpg)

---

## Подходы к кластеризации

1.  **На основе признаков (Feature-based):**
    *   Извлекают стат. признаки (среднее, дисперсия).
    *   Кластеризуют вектора (K-Means).
2.  **На основе формы (Shape-based):**
    *   **DTW (Dynamic Time Warping):** Учитывает временную динамику и фазовый сдвиг.
3.  **На основе моделей (Model-based):**
    *   Строят модель (ARIMA) для каждого ряда.
    *   Кластеризуют вектора параметров.

![w:500](https://d1m75rqqgidzqn.cloudfront.net/wp-data/2020/04/10160014/693.png)

---

### **Часть 7: Проблема холодного старта**

## Что такое "Холодный старт" (Cold Start)?

**Проблема:** Построить прогноз для объекта, по которому **очень мало исторических данных**.

**Примеры:**
*   Прогноз спроса для нового товара.
*   Прогноз нагрузки для нового сервера.

---

## Стратегии решения

1.  **Использование мета-признаков:**
    *   Найти "похожие" объекты с богатой историей (по категории, цене, бренду).
    *   Использовать их данные для прогноза.
2.  **Иерархическое прогнозирование:**
    *   Сделать прогноз на уровень категории.
    *   Распределить прогноз по новым товарам.
3.  **Байесовские подходы:**
    *   Meta-Learning, Hierarchical Bayesian Models.

---

### **Заключение**

## Сравнительная таблица методов

| Метод               | Плюсы                          | Минусы                             | Идеальный кейс                     |
|---------------------|--------------------------------|------------------------------------|------------------------------------|
| **ARIMA**           | Интерпретируемость, стандарт   | Требует стационарности             | Короткие стационарные ряды         |
| **Prophet**         | Автоматизация, праздники       | Черный ящик                        | Бизнес-ряды с сезонностью          |
| **Neural Prophet**  | Точность, внешние признаки     | Медленнее                          | Сложные ряды с контекстом          |
| **Деревья (GBM)**   | Точность, внешние признаки     | Риск data leakage                  | Прогнозирование с богатым контекстом |

---

## Ключевые выводы

1.  **Правильная валидация (Rolling Window) важнее выбора модели.**
2.  Не существует "серебряной пули". Выбор зависит от данных и требований.
3.  **ARIMA** — классика, **Prophet** — для быстрого старта, **Gradient Boosting** — для максимальной точности.
4.  Проблема **холодного старта** решается через мета-признаки и иерархические модели.

---

## Что почитать?

*   **Книги:**
    *   Hyndman, R.J. & Athanasopoulos, G. *"Forecasting: Principles and Practice"* — [OTexts.com](https://otexts.com/fpp3/)
*   **Библиотеки Python:**
    *   `statsmodels`, `pmdarima` (ARIMA)
    *   `prophet`, `neuralprophet`
    *   `sktime`, `tslearn` (кластеризация)

**Спасибо за внимание!**
**Вопросы?**